

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Document &mdash; NumPy Compatible Operator Benchmark  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/my_theme.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Operator prod" href="reports/prod.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> NumPy Compatible Operator Benchmark
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="report.html">Operator reports</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Document</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#ops">Ops</a></li>
<li class="toctree-l2"><a class="reference internal" href="#frameworks">Frameworks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#design">Design</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">NumPy Compatible Operator Benchmark</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Document</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/doc.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="document">
<h1>Document<a class="headerlink" href="#document" title="Permalink to this headline">¶</a></h1>
<div class="section" id="ops">
<h2>Ops<a class="headerlink" href="#ops" title="Permalink to this headline">¶</a></h2>
<p>We write configs for different categories of numpy operators, this can be obtain from <a class="reference external" href="https://github.com/mli/deepnumpy-doc">deepnumpy-doc</a>:</p>
<ul class="simple">
<li>Unary ops</li>
<li>Binary ops</li>
<li>Array creations</li>
<li>……</li>
</ul>
</div>
<div class="section" id="frameworks">
<h2>Frameworks<a class="headerlink" href="#frameworks" title="Permalink to this headline">¶</a></h2>
<p>We should support these frameworks:</p>
<ul class="simple">
<li>numpy</li>
<li>mxnet</li>
<li>chainerx &amp; cupy</li>
<li>jax</li>
<li>torch (TBD)</li>
<li>tensorflow 1&amp;2 (TBD)</li>
</ul>
</div>
<div class="section" id="design">
<h2>Design<a class="headerlink" href="#design" title="Permalink to this headline">¶</a></h2>
<p><strong>Blob package:</strong> Blob package simply store an op and its default config-gen function and default benchmark function in a python tuple.</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">add_blob</span> <span class="pre">=</span> <span class="pre">(ops.Add,</span> <span class="pre">get_random_size_config,</span> <span class="pre">run_binary_op_benchmark)</span></code>.</p>
<p><strong>Op package:</strong> in directory <code class="docutils literal notranslate"><span class="pre">operators</span></code>, ops with different numpy modules in different files, an Op object only need one argument, <code class="docutils literal notranslate"><span class="pre">backend</span></code>. All the ops under numpy should in <code class="docutils literal notranslate"><span class="pre">common_ops.py</span></code>, and linear algebra ops (under numpy.linalg) should be written in <code class="docutils literal notranslate"><span class="pre">la_ops.py</span></code> ……</p>
<p>In this part, most of ops can be generate by template. If the path to get the op function in each framework has the same pattern, we can add it by simply append its name in a list. Sample code is shown below, look <a class="reference external" href="../NumpyXBench/operators/common_ops.py">code</a> to get details.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">common_op_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;subtract&#39;</span><span class="p">,</span> <span class="s1">&#39;multiply&#39;</span><span class="p">,</span> <span class="s1">&#39;divide&#39;</span><span class="p">]</span> <span class="c1"># add op to here</span>

<span class="k">class</span> <span class="nc">CommonOp</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s1">&#39;numpy&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span> <span class="o">=</span> <span class="n">backend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">get_backend</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span>

    <span class="k">def</span> <span class="nf">get_forward_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;numpy&#39;</span><span class="p">,</span> <span class="s1">&#39;np&#39;</span><span class="p">]:</span>
            <span class="n">module</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;numpy&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mxnet&#39;</span><span class="p">,</span> <span class="s1">&#39;mx&#39;</span><span class="p">]:</span>
            <span class="n">module</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;mxnet.numpy&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pytorch&#39;</span><span class="p">,</span> <span class="s1">&#39;torch&#39;</span><span class="p">]:</span>
            <span class="n">module</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;torch&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Backend not supported now!&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Config package:</strong> get information of input arguments: <strong>input shape, dtype</strong> …… It depends on the type of op. Need to determine benchmark ways (random size/several determined size).</p>
<p><strong>Utils:</strong> functions to do benchmarks (<strong>single op, op cross frameworks, ops on single framework, and ops on frameworks</strong>).</p>
<p><strong>Metrics:</strong> speed, coverage (necessary), others TBD</p>
<p><strong>Others:</strong> need test, doc-gen, logging, report-gen, and visualization.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="reports/prod.html" class="btn btn-neutral float-left" title="Operator prod" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, hgt312

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>